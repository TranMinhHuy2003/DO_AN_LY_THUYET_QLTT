CREATE DATABASE QLXD;
USE QLXD;
-- TẠO BẢNG
CREATE TABLE DOANHNGHIEPNK (
    MADN CHAR(4) NOT NULL,
    TENDN VARCHAR(40),
    NGAYTL DATETIME,
    DIACHI VARCHAR(40),
    SDT VARCHAR(20),
    LOAIDN VARCHAR(20)
);
CREATE TABLE LOAIXANG (
    MALX CHAR(4) NOT NULL,
    TENLX VARCHAR(40),
    MDBQ VARCHAR(20)
);
CREATE TABLE XANGDAU (
    MAXD CHAR(4) NOT NULL,
    TENXD VARCHAR(40),
    MALX CHAR(4),
    GIACOSO DECIMAL(10 , 3 ),
    THUEPHI INT
);
CREATE TABLE CUAHANG (
    MACH CHAR(4) NOT NULL,
    TENCH VARCHAR(40),
    BACCL VARCHAR(2),
    RONGDD FLOAT,
    CAOTB FLOAT,
    CAOMC FLOAT,
    DIACHI VARCHAR(40)
);
CREATE TABLE NHAVANCHUYEN (
    MANVC CHAR(4) NOT NULL,
    TENNVC VARCHAR(40),
    SDT VARCHAR(20),
    DIACHI VARCHAR(40)
);
CREATE TABLE HOADON (
    SOHD CHAR(4) NOT NULL,
    MADN CHAR(4),
    MACH CHAR(4), 
    MANVC CHAR(4) NOT NULL,
    NGHD DATETIME,
    NGAYVC DATETIME,
    TRIGIA DECIMAL(20 , 3 )
);

CREATE TABLE CTHD (
    SOHD CHAR(4),
    MAXD CHAR(4),
    SOLUONG INT,
    GIANHAP DECIMAL(10 , 3 )
);

CREATE TABLE DN_XD (
    MADN CHAR(4),
    MAXD CHAR(4),
    NGAYNK DATETIME
);

-- KHÓA CHÍNH
ALTER TABLE DOANHNGHIEPNK ADD PRIMARY KEY (MADN);
ALTER TABLE LOAIXANG ADD PRIMARY KEY (MALX);
ALTER TABLE XANGDAU ADD PRIMARY KEY (MAXD);
ALTER TABLE CUAHANG ADD PRIMARY KEY (MACH);
ALTER TABLE NHAVANCHUYEN ADD PRIMARY KEY (MANVC);
ALTER TABLE HOADON ADD PRIMARY KEY (SOHD);
ALTER TABLE CTHD ADD PRIMARY KEY (SOHD, MAXD);
ALTER TABLE DN_XD ADD PRIMARY KEY (MADN, MAXD, NGAYNK);

-- KHÓA NGOẠI
ALTER TABLE XANGDAU ADD CONSTRAINT FK_xdMALX FOREIGN KEY (MALX) REFERENCES LOAIXANG(MALX);

ALTER TABLE HOADON ADD CONSTRAINT FK_hdMADN FOREIGN KEY (MADN) REFERENCES DOANHNGHIEPNK(MADN);
ALTER TABLE HOADON ADD CONSTRAINT FK_hdMACH FOREIGN KEY (MACH) REFERENCES CUAHANG(MACH);
ALTER TABLE HOADON ADD CONSTRAINT FK_hdMANVC FOREIGN KEY (MANVC) REFERENCES NHAVANCHUYEN(MANVC);

ALTER TABLE CTHD ADD CONSTRAINT FK_cthdpMAXD FOREIGN KEY (MAXD) REFERENCES XANGDAU(MAXD);
ALTER TABLE CTHD ADD CONSTRAINT FK_cthdSOHD FOREIGN KEY (SOHD) REFERENCES HOADON(SOHD);

ALTER TABLE DN_XD ADD CONSTRAINT FK_dnxdMADN FOREIGN KEY (MADN) REFERENCES DOANHNGHIEPNK(MADN);
ALTER TABLE DN_XD ADD CONSTRAINT FK_dnxdMAXD FOREIGN KEY (MAXD) REFERENCES XANGDAU(MAXD);
